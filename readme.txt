use some code from shadowsocks to speed up 